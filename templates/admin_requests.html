<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - Pickup Requests</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
}

body {
    background: linear-gradient(135deg, #1abc9c, #16a085);
    padding: 40px 0;
}

/* NAVBAR */
nav {
    width: 90%;
    max-width: 1100px;
    margin: auto;
    background: #fff;
    padding: 15px 25px;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

nav .logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

nav img {
    width: 50px;
}

nav a {
    margin-left: 15px;
    text-decoration: none;
    color: #1e3d34;
    font-weight: 500;
}

.logout-btn {
    background: #e63946;
    padding: 8px 20px;
    color: #fff;
    border-radius: 25px;
    font-weight: 600;
}

/* PANEL */
.panel {
    width: 90%;
    max-width: 1100px;
    margin: auto;
    background: #fff;
    padding: 35px;
    border-radius: 20px;
    box-shadow: 0 10px 35px rgba(0,0,0,0.15);
}

.panel h2 {
    text-align: center;
    margin-bottom: 25px;
    color: #1e3d34;
}

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: #27ae60;
    color: white;
    padding: 12px;
    text-align: left;
}

td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
}

/* STATUS BADGES */
.status {
    padding: 5px 10px;
    border-radius: 6px;
    color: #fff;
    font-size: 12px;
}

.pending { background: orange; }
.assigned { background: #0288d1; }
.in_progress { background: #8e24aa; }
.completed { background: #43a047; }
.recycled { background: #004d40; }

/* BUTTONS */
.assign-btn {
    background: #3949ab;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
}

.assign-btn:hover {
    background: #303f9f;
}

select {
    padding: 5px;
    border-radius: 5px;
}

@media(max-width: 768px){
    table { font-size: 13px; }
}
</style>
</head>

<body>

<nav>
    <div class="logo">
        <img src="https://cdn-icons-png.flaticon.com/512/728/728093.png">
        <b>Admin Panel</b>
    </div>
    <div>
        <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
        <a href="#">Requests</a>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>
</nav>

<div class="panel">
<h2>Pickup Requests Management</h2>
<tbody>
{% if requests|length == 0 %}
<tr>
    <td colspan="6" style="text-align:center;color:red;font-weight:bold;">
        No pickup requests found in database
    </td>
</tr>
{% endif %}

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>E-waste</th>
            <th>Center</th>     <!-- ✅ NEW -->
            <th>Agent</th>
            <th>Status</th>
            <th>Assign Pickup</th>
        </tr>
    </thead>

    <tbody>
        {% for r in requests %}
        <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.user_name }}</td>
            <td>{{ r.ewaste_type }}</td>

            <!-- Center -->
            <td>{{ r.center_name or '—' }}</td>

            <!-- Agent -->
            <td>{{ r.agent_name or '—' }}</td>

            <td>
                <span class="status {{ r.status }}">{{ r.status }}</span>
            </td>

            <td>
                <form method="POST" action="{{ url_for('admin_assign_pickup', pickup_id=r.id) }}">

                    <!-- Center dropdown -->
                    <select name="center_id">
                        <option value="">-- Select Center --</option>
                        {% for c in centers %}
                            <option value="{{ c.id }}">{{ c.center_name }}</option>
                        {% endfor %}
                    </select>

                    <!-- Agent dropdown -->
                    <select name="agent_id" required>
                        <option value="">-- Select Agent --</option>
                        {% for a in agents %}
                            <option value="{{ a.id }}">{{ a.fullname }}</option>
                        {% endfor %}
                    </select>

                    <button type="submit">Assign</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>

</body>
</html>
