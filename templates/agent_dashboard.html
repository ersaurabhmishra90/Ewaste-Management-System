<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Panel - E-Waste Management</title>

<style>
body {
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #0db37d, #0fb57b, #0fc279);
    background-attachment: fixed;
}

/* HEADER */
.header {
    width: 92%;
    margin: 20px auto;
    background: white;
    padding: 20px 30px;
    border-radius: 22px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0px 5px 20px rgba(0,0,0,0.12);
}

.header-left {
    display: flex;
    align-items: center;
}

.header-left img {
    width: 55px;
    height: 55px;
    margin-right: 15px;
    border-radius: 50%;
    object-fit: cover;
}

.header-title {
    font-size: 22px;
    font-weight: 700;
}

.header-sub {
    font-size: 13px;
    color: #555;
}

.logout-btn {
    background: #e63946;
    padding: 10px 22px;
    color: white;
    border-radius: 20px;
    font-weight: 600;
    text-decoration: none;
    font-size: 15px;
    transition: 0.3s;
}
.logout-btn:hover {
    background: #b71c1c;
}

.profile-btn {
    background:#0db37d;
    padding:10px 18px;
    border-radius:20px;
    font-size:15px;
    color:white;
    margin-right:8px;
    text-decoration:none;
    font-weight:600;
}

/* CONTAINER */
.container {
    width: 92%;
    margin: 20px auto;
    background: #fff;
    padding: 35px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
}

h2 {
    text-align: center;
    font-size: 28px;
    color: #1c4532;
    margin-bottom: 20px;
}

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

th, td {
    padding: 12px;
    border-bottom: 1px solid #ccc;
}

th {
    background: #0db37d;
    color: white;
    font-size: 15px;
}

tr:nth-child(even) {
    background: #f4f4f4;
}

/* STATUS FORM */
.status-form {
    display: flex;
    gap: 6px;
}

.status-form select {
    padding: 6px;
    border-radius: 8px;
    border: 1px solid #cfd9df;
}

.status-form button {
    padding: 6px 12px;
    background: #21c16d;
    border: none;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}

/* FLASH */
.flash {
    text-align:center;
    color:#e63946;
    font-size:14px;
}
</style>
</head>

<body>

<div class="header">
    <div class="header-left">
        {% if profile_pic %}
            <img src="{{ url_for('static', filename='uploads/' + profile_pic) }}" alt="profile">
        {% else %}
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="profile">
        {% endif %}
        <div>
            <div class="header-title">E-Waste Agent Panel</div>
            <div class="header-sub">Logged in as {{ name }}</div>
        </div>
    </div>

    <div>
        <a class="profile-btn" href="#">Profile</a>
        <a class="logout-btn" href="{{ url_for('logout') }}">Logout</a>
    </div>
</div>

<div class="container">
    <h2>Assigned Pickup Requests</h2>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <table>
        <tr>
            <th>ID</th>
            <th>Center</th>
            <th>Address</th>
            <th>Status</th>
            <th>Action</th>
        </tr>

        {% if pickups %}
            {% for p in pickups %}
            <tr>
                <td>{{ p.id }}</td>
                <td>{{ p.center_name }}</td>
                <td>{{ p.address }}</td>
                <td>{{ p.status|capitalize }}</td>
                <td>
                    <form class="status-form" method="POST"
                          action="{{ url_for('agent_update_pickup_status', pickup_id=p.id) }}">

                        <select name="status">
                            <option value="picked_up" {% if p.status == 'picked_up' %}selected{% endif %}>
                                Picked Up
                            </option>
                            <option value="handed_over" {% if p.status == 'handed_over' %}selected{% endif %}>
                                Handed Over
                            </option>
                        </select>

                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="5" style="text-align:center;">No assigned pickups</td>
            </tr>
        {% endif %}
    </table>
</div>

</body>
</html>
